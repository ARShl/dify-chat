services:
  dify-chat:
    container_name: dify-chat
    image: dify-chat:latest
    volumes:
      - ./nginx/nginx.conf.template:/etc/nginx/nginx.conf.template
      - ./nginx/https.conf.template:/etc/nginx/https.conf.template
      - ./nginx/conf.d:/etc/nginx/conf.d
      - ./nginx/docker-entrypoint.sh:/docker-entrypoint-mount.sh
      - ./nginx/ssl:/etc/ssl
    ports:
      - ${EXPOSE_NGINX_PORT}:${NGINX_PORT}
      - ${EXPOSE_NGINX_SSL_PORT}:${NGINX_SSL_PORT}
    entrypoint: [ 'sh', '-c', "cp /docker-entrypoint-mount.sh /docker-entrypoint.sh && sed -i 's/\r$$//' /docker-entrypoint.sh && chmod +x /docker-entrypoint.sh && /docker-entrypoint.sh" ]
    networks:
      - dify-chat
    restart: on-failure
    env_file: .env
networks:
  dify-chat:
    driver: bridge
